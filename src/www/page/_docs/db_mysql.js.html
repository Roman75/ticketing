<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>db/mysql.js - Documentation</title>
    
    
    
    
    
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    
    <meta property="og:url" content=""/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://myproject.com" target="_blank" class="menu-item" id="website_link" >Project Website</a></h2><h2><a href="https://myproject.com.forum" target="_blank" class="menu-item" id="forum_link" >Forum</a></h2><h3>Namespaces</h3><ul><li></li></ul><h3>Classes</h3><ul><li><a href="MySql.html">MySql</a><ul class='methods'><li data-type='method' style='display: none;'><a href="MySql.html#query">query</a></li><li data-type='method' style='display: none;'><a href="MySql.html#promiseQuery">promiseQuery</a></li><li data-type='method' style='display: none;'><a href="MySql.html#promiseInsert">promiseInsert</a></li><li data-type='method' style='display: none;'><a href="MySql.html#promiseSelect">promiseSelect</a></li><li data-type='method' style='display: none;'><a href="MySql.html#promiseSelectFulltext">promiseSelectFulltext</a></li><li data-type='method' style='display: none;'><a href="MySql.html#promiseUpdate">promiseUpdate</a></li><li data-type='method' style='display: none;'><a href="MySql.html#promiseDelete">promiseDelete</a></li><li data-type='method' style='display: none;'><a href="MySql.html#promiseCount">promiseCount</a></li><li data-type='method' style='display: none;'><a href="MySql.html#promiseTranslateSelect">promiseTranslateSelect</a></li><li data-type='method' style='display: none;'><a href="MySql.html#promiseTranslateReplace">promiseTranslateReplace</a></li><li data-type='method' style='display: none;'><a href="MySql.html#promiseArchive">promiseArchive</a></li><li data-type='method' style='display: none;'><a href="MySql.html#_where">_where</a></li><li data-type='method' style='display: none;'><a href="MySql.html#_order">_order</a></li><li data-type='method' style='display: none;'><a href="MySql.html#_log">_log</a></li></ul></li><li><a href="Helpers.html">Helpers</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Helpers.html#generateUUID">generateUUID</a></li><li data-type='method' style='display: none;'><a href="Helpers.html#getDateTime">getDateTime</a></li><li data-type='method' style='display: none;'><a href="Helpers.html#getEan8Checksum">getEan8Checksum</a></li><li data-type='method' style='display: none;'><a href="Helpers.html#_logMessage">_logMessage</a></li><li data-type='method' style='display: none;'><a href="Helpers.html#_logError">_logError</a></li><li data-type='method' style='display: none;'><a href="Helpers.html#logSocketMessage">logSocketMessage</a></li><li data-type='method' style='display: none;'><a href="Helpers.html#logSocketWarn">logSocketWarn</a></li><li data-type='method' style='display: none;'><a href="Helpers.html#logSocketError">logSocketError</a></li></ul></li><li><a href="Http.html">Http</a></li><li><a href="Event.html">Event</a></li><li><a href="Floor.html">Floor</a></li><li><a href="List.html">List</a><ul class='methods'><li data-type='method' style='display: none;'><a href="List.html#create">create</a></li><li data-type='method' style='display: none;'><a href="List.html#update">update</a></li><li data-type='method' style='display: none;'><a href="List.html#init">init</a></li><li data-type='method' style='display: none;'><a href="List.html#fetch">fetch</a></li><li data-type='method' style='display: none;'><a href="List.html#_promiseList">_promiseList</a></li><li data-type='method' style='display: none;'><a href="List.html#_promiseListColumn">_promiseListColumn</a></li></ul></li><li><a href="Location.html">Location</a></li><li><a href="Module.html">Module</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Module.html#create">create</a></li><li data-type='method' style='display: none;'><a href="Module.html#update">update</a></li><li data-type='method' style='display: none;'><a href="Module.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="Module.html#fetch">fetch</a></li><li data-type='method' style='display: none;'><a href="Module.html#fetchAll">fetchAll</a></li><li data-type='method' style='display: none;'><a href="Module.html#getConnID">getConnID</a></li><li data-type='method' style='display: none;'><a href="Module.html#getConnUserID">getConnUserID</a></li><li data-type='method' style='display: none;'><a href="Module.html#getError">getError</a></li><li data-type='method' style='display: none;'><a href="Module.html#generateUUID">generateUUID</a></li><li data-type='method' style='display: none;'><a href="Module.html#getDateTime">getDateTime</a></li><li data-type='method' style='display: none;'><a href="Module.html#getEan8Checksum">getEan8Checksum</a></li><li data-type='method' style='display: none;'><a href="Module.html#_logMessage">_logMessage</a></li><li data-type='method' style='display: none;'><a href="Module.html#_logError">_logError</a></li><li data-type='method' style='display: none;'><a href="Module.html#logSocketMessage">logSocketMessage</a></li><li data-type='method' style='display: none;'><a href="Module.html#logSocketWarn">logSocketWarn</a></li><li data-type='method' style='display: none;'><a href="Module.html#logSocketError">logSocketError</a></li></ul></li><li><a href="Order.html">Order</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Order.html#setUser">setUser</a></li><li data-type='method' style='display: none;'><a href="Order.html#setUserData">setUserData</a></li><li data-type='method' style='display: none;'><a href="Order.html#setTicket">setTicket</a></li><li data-type='method' style='display: none;'><a href="Order.html#setSeat">setSeat</a></li><li data-type='method' style='display: none;'><a href="Order.html#addSpecialOffer">addSpecialOffer</a></li><li data-type='method' style='display: none;'><a href="Order.html#setDiscount">setDiscount</a></li><li data-type='method' style='display: none;'><a href="Order.html#setPayment">setPayment</a></li><li data-type='method' style='display: none;'><a href="Order.html#empty">empty</a></li><li data-type='method' style='display: none;'><a href="Order.html#del">del</a></li><li data-type='method' style='display: none;'><a href="Order.html#fetchOrder">fetchOrder</a></li><li data-type='method' style='display: none;'><a href="Order.html#fetchAll">fetchAll</a></li><li data-type='method' style='display: none;'><a href="Order.html#cancelItem">cancelItem</a></li><li data-type='method' style='display: none;'><a href="Order.html#save">save</a></li><li data-type='method' style='display: none;'><a href="Order.html#createPDFs">createPDFs</a></li><li data-type='method' style='display: none;'><a href="Order.html#sendMail">sendMail</a></li><li data-type='method' style='display: none;'><a href="Order.html#_createPDFBill">_createPDFBill</a></li><li data-type='method' style='display: none;'><a href="Order.html#_createPDFTickets">_createPDFTickets</a></li><li data-type='method' style='display: none;'><a href="Order.html#_calculate">_calculate</a></li></ul></li><li><a href="OrderDetail.html">OrderDetail</a></li><li><a href="OrderTax.html">OrderTax</a></li><li><a href="Promoter.html">Promoter</a></li><li><a href="Reservation.html">Reservation</a></li><li><a href="ReservationDetail.html">ReservationDetail</a></li><li><a href="Room.html">Room</a></li><li><a href="Seat.html">Seat</a></li><li><a href="Table.html">Table</a></li><li><a href="Ticket.html">Ticket</a></li><li><a href="User.html">User</a><ul class='methods'><li data-type='method' style='display: none;'><a href="User.html#login">login</a></li><li data-type='method' style='display: none;'><a href="User.html#logout">logout</a></li><li data-type='method' style='display: none;'><a href="User.html#logoutToken">logoutToken</a></li><li data-type='method' style='display: none;'><a href="User.html#logoutTokenExpired">logoutTokenExpired</a></li><li data-type='method' style='display: none;'><a href="User.html#create">create</a></li><li data-type='method' style='display: none;'><a href="User.html#update">update</a></li><li data-type='method' style='display: none;'><a href="User.html#fetch">fetch</a></li><li data-type='method' style='display: none;'><a href="User.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="User.html#fetchByEmail">fetchByEmail</a></li><li data-type='method' style='display: none;'><a href="User.html#_hashPassword">_hashPassword</a></li><li data-type='method' style='display: none;'><a href="User.html#fetchAll">fetchAll</a></li><li data-type='method' style='display: none;'><a href="User.html#getConnID">getConnID</a></li><li data-type='method' style='display: none;'><a href="User.html#getConnUserID">getConnUserID</a></li><li data-type='method' style='display: none;'><a href="User.html#getError">getError</a></li><li data-type='method' style='display: none;'><a href="User.html#generateUUID">generateUUID</a></li><li data-type='method' style='display: none;'><a href="User.html#getDateTime">getDateTime</a></li><li data-type='method' style='display: none;'><a href="User.html#getEan8Checksum">getEan8Checksum</a></li><li data-type='method' style='display: none;'><a href="User.html#_logMessage">_logMessage</a></li><li data-type='method' style='display: none;'><a href="User.html#_logError">_logError</a></li><li data-type='method' style='display: none;'><a href="User.html#logSocketMessage">logSocketMessage</a></li><li data-type='method' style='display: none;'><a href="User.html#logSocketWarn">logSocketWarn</a></li><li data-type='method' style='display: none;'><a href="User.html#logSocketError">logSocketError</a></li></ul></li><li><a href="Socket.SocketPaymentSystemMPAY24.html">SocketPaymentSystemMPAY24</a></li><li><a href="Socket.html">Socket</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Socket.html#onConnect">onConnect</a></li><li data-type='method' style='display: none;'><a href="Socket.html#onDisconnect">onDisconnect</a></li><li data-type='method' style='display: none;'><a href="Socket.html#onSetIntern">onSetIntern</a></li><li data-type='method' style='display: none;'><a href="Socket.html#onSetEvent">onSetEvent</a></li><li data-type='method' style='display: none;'><a href="Socket.html#onSetEventSubdomain">onSetEventSubdomain</a></li><li data-type='method' style='display: none;'><a href="Socket.html#onSetLanguage">onSetLanguage</a></li><li data-type='method' style='display: none;'><a href="Socket.html#_detectLang">_detectLang</a></li></ul></li><li><a href="Socket.SocketEvent.html">SocketEvent</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Socket.SocketEvent.html#onCreate">onCreate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketEvent.html#onUpdate">onUpdate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketEvent.html#onDelete">onDelete</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketEvent.html#onFetch">onFetch</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketEvent.html#onFetchDetail">onFetchDetail</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketEvent.html#onCopy">onCopy</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketEvent.html#onCheckPrefix">onCheckPrefix</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketEvent.html#onCheckPrefix">onCheckPrefix</a></li></ul></li><li><a href="Socket.SocketFloor.html">SocketFloor</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Socket.SocketFloor.html#onCreate">onCreate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketFloor.html#onUpdate">onUpdate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketFloor.html#onDelete">onDelete</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketFloor.html#onFetch">onFetch</a></li></ul></li><li><a href="Socket.SocketForm.html">SocketForm</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Socket.SocketForm.html#onInit">onInit</a></li></ul></li><li><a href="Socket.SocketList.html">SocketList</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Socket.SocketList.html#onCreate">onCreate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketList.html#onUpdate">onUpdate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketList.html#onDelete">onDelete</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketList.html#onInit">onInit</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketList.html#onFetch">onFetch</a></li></ul></li><li><a href="Socket.SocketLocation.html">SocketLocation</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Socket.SocketLocation.html#onCreate">onCreate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketLocation.html#onUpdate">onUpdate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketLocation.html#onDelete">onDelete</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketLocation.html#onFetch">onFetch</a></li></ul></li><li><a href="Socket.SocketOrder.html">SocketOrder</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Socket.SocketOrder.html#onSave">onSave</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketOrder.html#onSetUser">onSetUser</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketOrder.html#onSetTicket">onSetTicket</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketOrder.html#onAddSeat">onAddSeat</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketOrder.html#onAddSpecialOffer">onAddSpecialOffer</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketOrder.html#onSetDiscount">onSetDiscount</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketOrder.html#onSetUser">onSetUser</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketOrder.html#onSetPayment">onSetPayment</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketOrder.html#onDel">onDel</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketOrder.html#onEmpty">onEmpty</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketOrder.html#onCheckout">onCheckout</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketOrder.html#onPayIntern">onPayIntern</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketOrder.html#onMpay24Seamless">onMpay24Seamless</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketOrder.html#onUpdate">onUpdate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketOrder.html#onChancelItem">onChancelItem</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketOrder.html#onFetchOrder">onFetchOrder</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketOrder.html#onFetchAll">onFetchAll</a></li></ul></li><li><a href="Socket.SocketPromoter.html">SocketPromoter</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Socket.SocketPromoter.html#onCreate">onCreate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketPromoter.html#onUpdate">onUpdate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketPromoter.html#onDelete">onDelete</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketPromoter.html#onFetch">onFetch</a></li></ul></li><li><a href="Socket.SocketReservation.html">SocketReservation</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Socket.SocketReservation.html#onCreate">onCreate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketReservation.html#onUpdate">onUpdate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketReservation.html#onDelete">onDelete</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketReservation.html#onFetch">onFetch</a></li></ul></li><li><a href="Socket.SocketRoom.html">SocketRoom</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Socket.SocketRoom.html#onCreate">onCreate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketRoom.html#onUpdate">onUpdate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketRoom.html#onDelete">onDelete</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketRoom.html#onFetch">onFetch</a></li></ul></li><li><a href="Socket.SocketScan.html">SocketScan</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Socket.SocketScan.html#onCreate">onCreate</a></li></ul></li><li><a href="Socket.SocketSeat.html">SocketSeat</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Socket.SocketSeat.html#onCreate">onCreate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketSeat.html#onUpdate">onUpdate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketSeat.html#onDelete">onDelete</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketSeat.html#onFetch">onFetch</a></li></ul></li><li><a href="Socket.SocketTable.html">SocketTable</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Socket.SocketTable.html#onCreate">onCreate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketTable.html#onUpdate">onUpdate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketTable.html#onDelete">onDelete</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketTable.html#onFetch">onFetch</a></li></ul></li><li><a href="Socket.SocketTicket.html">SocketTicket</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Socket.SocketTicket.html#onCreate">onCreate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketTicket.html#onUpdate">onUpdate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketTicket.html#onDelete">onDelete</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketTicket.html#onFetch">onFetch</a></li></ul></li><li><a href="Socket.SocketTranslation.html">SocketTranslation</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Socket.SocketTranslation.html#onReplace">onReplace</a></li></ul></li><li><a href="Socket.SocketUser.html">SocketUser</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Socket.SocketUser.html#onCreate">onCreate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketUser.html#onUpdate">onUpdate</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketUser.html#onDelete">onDelete</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketUser.html#onFetch">onFetch</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketUser.html#onLogin">onLogin</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketUser.html#onLogout">onLogout</a></li><li data-type='method' style='display: none;'><a href="Socket.SocketUser.html#onLogoutByToken">onLogoutByToken</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">db/mysql.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Helpers from './../helpers';
import mysql from 'mysql';
import _ from 'lodash';

const logPrefix = 'MYSQL   ';

class MySql extends Helpers {

	/**
	 * create connection pool for mysql database&lt;br>
	 * create instance for all modules&lt;br>
	 * look also at: &lt;a target="_blank" href="https://www.npmjs.com/package/sequelize">https://www.npmjs.com/package/sequelize&lt;/a> (TODO)
	 * @param config {Object} connection configuration
	 */
	constructor(config) {
		super();
		this._debug = false;
		this._translate = {};
		this._pool = mysql.createPool(_.extend(config.conn, {multipleStatements: true}));
		this._log('created pool with ' + config.conn.connectionLimit + ' connection(s)');
	}

	/**
	 * Query Database without a Promise
	 * @param {String} sql native sql query (INSERT INTO table (`field1`,`field2`,`field3`) VALUES (?,?));
	 * @param {Array} values array of values (Array('value1','value2',123))
	 */
	query(sql, values = []) {
		this._pool.getConnection((err, conn) => {
			if (!err &amp;&amp; conn) {
				conn.query(sql, values, (err, res) => {
					this._log(sql + ' ' + JSON.stringify(values), err);
					conn.release();
				});
			} else {
				this._log(null, err);
			}
		});
	}

	/**
	 * Query Database with a Promise
	 * @param {String} sql native sql query (INSERT INTO table (`field1`,`field2`,`field3`) VALUES (?,?,?);
	 * @param {Array} values array of values (Array('value1','value2',123))
	 * @returns {Promise&lt;any>} with resultset of this query in the resolve callback
	 */
	promiseQuery(sql, values = []) {
		return new Promise((resolve, reject) => {
			this._pool.getConnection((err, conn) => {
				if (!err &amp;&amp; conn) {
					conn.query(sql, values, (err, res) => {
						this._log(sql + ' ' + JSON.stringify(values), err);
						if (err) {
							reject(err);
						} else {
							resolve(res);
						}
						conn.release();
					});
				} else {
					this._log(null, err);
					reject(err);
				}
			});
		});
	}

	/**
	 * promised insert query
	 * @param table {String} database table name
	 * @param data {Object|Array} object with fieldname => value pairs ({'field1':'value1', 'field2':'value2'}) | array of objects for multiple row insert => array value pairs ([{'field1':'value1', 'field2':'value2'},{'field3':'value1', 'field2':'value4'}])
	 * @returns {Promise&lt;any>} with resultset of this query in the resolve callback
	 */
	promiseInsert(table, data) {
		return new Promise((resolve, reject) => {
			this._pool.getConnection((err, conn) => {
				if (!err &amp;&amp; conn) {
					let sql = 'INSERT INTO `' + table + '` (';
					let questionmarks = '';
					let values = [];
					let comma = '';
					if (_.isArray(data)) {
						_.each(data[0], (value, field) => {
							sql += comma + '`' + field + '`';
							questionmarks += comma + '?';
							comma = ',';
						});
						sql += ') VALUES ';
						comma = '';
						_.each(data, (row) => {
							sql += comma + '(' + questionmarks + ')';
							comma = ',';
							_.each(row, (value) => {
								values.push((_.isObject(value)) ? JSON.stringify(value) : value);
							});
						});
					} else if (_.isObject(data)) {
						_.each(data, (value, field) => {
							values.push((_.isObject(value)) ? JSON.stringify(value) : value);
							sql += comma + '`' + field + '`';
							questionmarks += comma + '?';
							comma = ',';
						});
						sql += ') VALUES (' + questionmarks + ')';
					}
					conn.query(sql, values, (err, res) => {
						this._log(sql + ' ' + JSON.stringify(values), err);
						if (err) {
							reject(err);
						} else {
							resolve(_.extend(res, {'data': data}));
						}
						conn.release();
					});
				} else {
					this._log(null, err);
					reject(err);
				}
			});
		});
	}

	/**
	 * promised select query
	 * @param table {String} database table name
	 * @param fields {Array|null} array of fields which will be returned by the select query | if fields is null all fields will be returned
	 * @param where {Array|Object|null} where condition for this query
	 *          - array       => multiple objects for the where condition ([{'field1':'value1'},{'field2':'value2']])&lt;br>
	 * 			- object      => object with two elements ({'conditions':'(field1 = ? and field2 = ?) or (field3 > ? or field3 &lt; ?)','values':['abc','def',1,2]})&lt;br>
	 * 			- object      => object of field value pair ({'field':'value'})&lt;br>
	 * 			- null		  => if where condition is null all rows will be returned
	 * @param order {Array|Object|String|null} order condition for this query
	 *          - array       => array of objects ([{'field1':'asc'},{'field2':'desc'},{'field3':'' &lt;= empty same as asc>}])&lt;br>
	 *          - object      => object of field and orderdir ({'field':'desc|asc'})&lt;br>
	 *          - string      => native order by condition ('field1 asc, field2 desc, field3')&lt;br>
	 *          - null        => no order by condition for this select query
	 * @param from {Integer} limit from for this query
	 * @param count {Integer} limit count for this query
	 * @returns {Promise&lt;any>} with resultset of this query in the resolve callback
	 */
	promiseSelect(table, fields = null, where = null, order = null, from = null, count = null) {
		return new Promise((resolveSelect, rejectSelect) => {
			this._pool.getConnection((err, conn) => {
				if (!err &amp;&amp; conn) {
					fields = (fields !== null &amp;&amp; _.isArray(fields)) ? '`' + _.join(fields, '`,`') + '`' : '*';
					let conditionWhere = this._where(where);
					let conditionOrder = this._order(order);
					let sql = 'SELECT ' + fields + ' FROM `' + table + '`';
					sql += conditionWhere.where;
					sql += conditionOrder;
					if (from != null &amp;&amp; count != null) {
						sql += ' LIMIT ' + from + ',' + count;
					} else if (from == null &amp;&amp; count != null) {
						sql += ' LIMIT ' + count;
					}
					conn.query(sql, conditionWhere.values, (err, res) => {
						this._log(sql + ' ' + JSON.stringify(conditionWhere.values), err);
						if (err) {
							rejectSelect(err);
						} else {
							resolveSelect(res);
						}
						conn.release();
					});
				} else {
					this._log(null, err);
					rejectSelect(err);
				}
			});
		});
	}

	/**
	 * promise select fulltext search query
	 * TODO: implementation :)
	 * @param table {String} database table name
	 * @param fields {Array|null} array of fields which will be returned by the select query | if fields is null all fields will be returned
	 * @param match {String} string of fields for fulltext search ('UserCompany, UserFirstname, UserLastname, UserEmail')
	 * @param against {String} string to search for
	 * @returns {Promise&lt;any>} with resultset of this query in the resolve callback
	 */
	promiseSelectFulltext(table, fields = null, match, against) {
		// Select * from students where match(first_name, last_name) AGAINST ('Ade');
	}

	/**
	 * promised update query&lt;br>
	 * before update is processed a select is done and data where saved to archive table&lt;br>
	 * @param table {String} database table name
	 * @param data {Object} object with fieldname => value pairs ({'field1':'value1', 'field2':'value12'});
	 * @param where {Array|Object|null} where condition for this query
	 * @returns {Promise&lt;any>} with resultset of this query in the resolve callback
	 */
	promiseUpdate(table, data, where) {
		return new Promise((resolveUpdate, rejectUpdate) => {
			this._pool.getConnection((err, conn) => {
				if (!err &amp;&amp; conn) {
					let sql = 'UPDATE `' + table + '` SET ';
					let values = [];
					let comma = '';
					_.each(data, (value, field) => {
						sql += comma + '`' + field + '`=?';
						values.push((_.isObject(value)) ? JSON.stringify(value) : value);
						comma = ',';
					});
					let condition = this._where(where);
					sql += condition.where;
					values = values.concat(condition.values);
					if (condition.where &amp;&amp; _.size(condition.values)) {
						this._log(sql + ' ' + JSON.stringify(values), err);
						conn.query(sql, values, (err, res) => {
							if (err) {
								console.log(err);
								rejectUpdate(err);
							} else {
								resolveUpdate(res);
							}
							conn.release();
						});
					} else {
						this._log(null, 'UPDATE operation without WHERE condition is not allowed!');
						this._log(null, sql);
						this._log(null, where);
						rejectDelete(err);
					}
				} else {
					this._log(null, err);
					rejectUpdate(err);
				}
			});
		});
	}

	/**
	 * promised delete query&lt;br>
	 * before delete is processed a select is done and data where saved to archive table&lt;br>
	 * @param table {String} database table name
	 * @param where {Array|Object} where condition for this query
	 * @returns {Promise&lt;any>} with resultset of this query in the resolve callback
	 */
	promiseDelete(table, where) {
		return new Promise((resolveDelete, rejectDelete) => {
			this._pool.getConnection((err, conn) => {
				if (!err &amp;&amp; conn) {
					let sql = 'DELETE FROM `' + table + '`';
					let condition = this._where(where);
					sql += condition.where;
					if (condition.where &amp;&amp; _.size(condition.values)) {
						conn.query(sql, condition.values, (err, res) => {
							this._log(sql + ' ' + JSON.stringify(condition.values), err);
							if (err) {
								this._log(null, err);
								rejectDelete(err);
							} else {
								resolveDelete(condition.values);
							}
							conn.release();
						});
					} else {
						this._log(null, 'DELETE operation without WHERE condition is not allowed!');
						this._log(null, sql);
						this._log(null, where);
						rejectDelete(err);
					}
				} else {
					this._log(null, err);
					rejectDelete(err);
				}
			});
		});
	}

	/**
	 * promised count query&lt;br>
	 * http://www.mysqltutorial.org/mysql-count/
	 * @param table {String} database table name
	 * @param where {Array|Object|null} where condition for this query
	 * @param fields {String|*} optional parameter - string which will be used for the select count query (eg field1,COUNT(field2) AS count) | if fields is empty COUNT(*) is used
	 * @param groupby {String} optional parameter - string for a GROUP BY condition
	 * @param having {String} optional parameter - string for a HAVING condition
	 * @returns {Promise&lt;any>} with resultset of this query in the resolve callback
	 */
	promiseCount(table, where = null, fields = '*', groupby = null, having = null) {
		return new Promise((resolveCount, rejectCont) => {
			this._pool.getConnection((err, conn) => {
				if (!err &amp;&amp; conn) {
					fields = (fields !== '*' &amp;&amp; fields) ? fields : 'COUNT(*)';
					let sql = 'SELECT ' + fields + ' FROM `' + table + '`';
					let condition = this._where(where);
					sql += condition.where;
					(groupby !== null) ? sql += ' GROUP BY ' + groupby : null;
					(having !== null) ? sql += ' HAVING ' + having : null;
					conn.query(sql, condition.values, (err, res) => {
						this._log(sql + ' ' + JSON.stringify(condition.values), err);
						if (err) {
							rejectCont(err);
						} else {
							resolveCount(res);
						}
						conn.release();
					});
				} else {
					this._log(null, err);
					rejectCont(err);
				}
			});
		});
	}

	/**
	 * select translation value
	 * @param Token {String}
	 * @param LangCode {String}
	 * @param TransID {String}
	 * @returns {Promise&lt;any>}
	 */
	promiseTranslateSelect(Token, LangCode, TransID = null) {
		let index = TransID + LangCode + Token;
		return new Promise((resolveTranslate, rejectTranslate) => {
			if (this._translate.indexOf(index) === -1) {
				this._pool.getConnection((err, conn) => {
					if (!err &amp;&amp; conn) {
						let sql = "SELECT TransValue FROM `feTrans` WHERE ";
						TransID ? sql += 'TransID = ? ' : sql += 'TransID IS ? ';
						Token ? sql += 'AND TransToken = ? ' : sql += 'AND TransToken IS ? ';
						LangCode ? sql += 'AND TransLangCode = ? ' : sql += 'AND TransLangCode IS ? ';
						conn.query(sql, [TransID, Token, LangCode], (err, res) => {
							this._log(sql, err);
							if (err) {
								rejectTranslate(err);
							} else {
								this._translate[index] = res[0].TransValue;
								resolveTranslate(this._translate[index]);
							}
							conn.release();
						});
					} else {
						this._log(null, err);
						rejectTranslate(err);
					}
				});
			} else {
				resolveTranslate(this._translate[index]);
			}
		});
	}

	/**
	 * insert or update token value
	 * @param Token {String}
	 * @param LangCode {String}
	 * @param Value {String}
	 * @param TransID {String}
	 * @returns {Promise&lt;any>}
	 */
	promiseTranslateReplace(values) {
		let index = values.TransID ? values.TransID : '';
		index += values.LangCode ? values.LangCode : '';
		index += values.Token ? values.Token : '';
		this._translate[index] = values.Value ? values.Value : '';
		return new Promise((resolve, reject) => {
			this._pool.getConnection((err, conn) => {
				if (!err &amp;&amp; conn) {
					let sql = "SELECT TransValue FROM `feTrans` WHERE ";
					values.TransID ? sql += 'TransID = ? ' : sql += 'TransID IS ? ';
					values.Token ? sql += 'AND TransToken = ? ' : sql += 'AND TransToken IS ? ';
					values.LangCode ? sql += 'AND TransLangCode = ? ' : sql += 'AND TransLangCode IS ? ';
					let sqlValues = [values.TransID ? values.TransID : null, values.Token ? values.Token : null, values.LangCode ? values.LangCode : null];
					conn.query(sql, sqlValues, (err, res) => {
						if (err) {
							this._log(sql + ' ' + JSON.stringify(values), err);
							reject(err);
						} else {
							let sql = '';
							let sqlValues = [];
							if (_.size(res)) {
								sql = "UPDATE `feTrans` SET TransValue = ? WHERE ";
								values.TransID ? sql += 'TransID = ? ' : sql += 'TransID IS ? ';
								values.Token ? sql += 'AND TransToken = ? ' : sql += 'AND TransToken IS ? ';
								values.LangCode ? sql += 'AND TransLangCode = ? ' : sql += 'AND TransLangCode IS ? ';
								sqlValues = [values.Value ? values.Value : null, values.TransID ? values.TransID : null, values.Token ? values.Token : null, values.LangCode ? values.LangCode : null];
							} else {
								sql = 'INSERT INTO `feTrans` (TransID,TransToken,TransLangCode,TransTransGroupID,TransValue) VALUES (?,?,?,?,?)';
								sqlValues = [values.TransID ? values.TransID : null, values.Token ? values.Token : null, values.LangCode ? values.LangCode : null, values.Group ? values.Group : null, values.Value ? values.Value : null];
							}
							conn.query(sql, sqlValues, (err, res) => {
								conn.release();
								this._log(sql + ' ' + JSON.stringify(sqlValues), err);
								if (err) {
									reject(err);
								} else {
									resolve(res);
								}
							});
						}
					});
				} else {
					this._log(null, err);
					reject(err);
				}
			});
		});

	}

	/**
	 * archives data to `archiveRow` and `archiveRowData` tables according to the where condition&lt;br>
	 * also multiple rows can be archived, it depends on the where condition
	 * @param table {String} database table name
	 * @param where {Array|Object|null} where condition for this query
	 * TODO: implementation :)
	 */
	promiseArchive(table, where) {
		return new Promise((resolveArchive, rejectArchive) => {
			this._pool.getConnection((err, conn) => {
				if (!err &amp;&amp; conn) {
					this.promiseSelect(table, null, where).then((res) => {
						if (_.size(res)) {
							_.each(res, (row) => {
								console.log(row);
							});
						} else {

						}
						resolveArchive();
					}).catch((err) => {
						rejectArchive(err);
					});
				} else {
					this._log(null, err);
					rejectArchive(err);
				}
			});
		});
	}

	/**
	 * creates the where condition for queries (select, update, delete)
	 * @param where {Array|Object|null}
	 *          - array       => multiple objects for the where condition ([{'field1':'value1'},{'field2':'value2']])&lt;br>
	 * 			- object      => object with two elements ({'conditions':'(field1 = ? and field2 = ?) or (field3 > ? or field3 &lt; ?)','values':['abc','def',1,2]})&lt;br>
	 * 			- object      => object of field value pair ({'field':'value'})&lt;br>
	 * 			- null		  => if where condition is null all rows will be returned
	 * @returns {Object} object with condition string and values as array
	 * @private
	 */
	_where(where) {
		let whereString = '';
		let valuesArray = [];
		let ret = {
			'where': whereString,
			'values': valuesArray
		};
		if (where !== null) {
			if (_.isArray(where) || (_.isObject(where) &amp;&amp; (!where.conditions || !where.values))) {
				let and = '';
				_.each(where, (value, field) => {
					whereString += and + field + "=?";
					valuesArray.push(value);
					and = ' AND ';
				});
			} else if (_.isObject(where) &amp;&amp; where.conditions &amp;&amp; where.values) {
				whereString += where.conditions;
				valuesArray = where.values;
			}
			if (whereString &amp;&amp; _.size(valuesArray)) {
				ret = {
					'where': ' WHERE ' + whereString,
					'values': valuesArray
				}
			}
		}
		return ret;
	}

	/**
	 * creates the order condition string for a select query
	 * @param order {Array|Object|String|null} array of objects for order by for this query&lt;br>
	 *          - array       => array of objects ([{'field1':'asc'},{'field2':'desc'},{'field3':'' &lt;= empty same as asc>}])&lt;br>
	 *          - object      => object of field and orderdir ({'field':'desc|asc'})&lt;br>
	 *          - string      => native order by condition ('field1 asc, field2 desc, field3')&lt;br>
	 *          - null        => no order by condition for this select query
	 * @returns {String} string with order condition
	 * @private
	 */
	_order(order) {
		let orderString = '';
		if (order !== null &amp;&amp; _.size(order)) {
			orderString += ' ORDER BY ';
			if (_.isArray(order)) {
				let comma = '';
				_.each(order, (obj) => {
					orderString += comma + Object.keys(obj);
					if (obj[Object.keys(obj)].toLowerCase() === 'desc') {
						orderString += ' DESC';
					}
					comma = ',';
				});
			} else if (_.isObject(order)) {
				orderString += Object.keys(order);
				if (order[Object.keys(order)].toLowerCase() === 'desc') {
					orderString += ' DESC';
				}
			} else {
				orderString += order;
			}
		}
		return orderString;
	}

	/** log messages and errors **/
	_log(message = null, error = null) {
		if (this._debug) {
			if (!error) {
				LOG.msg(logPrefix, message);
			} else {
				LOG.err(logPrefix, error);
			}
		}
	}
};

module.exports = MySql;
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Jun 23 2019 12:55:57 GMT+0200 (GMT+02:00) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/jquery-3.1.1.min.js"></script>

<script src="scripts/search.js"></script>


<script src="scripts/collapse.js"></script>



</body>
</html>
